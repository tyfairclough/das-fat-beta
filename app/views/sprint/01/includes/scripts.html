<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>

<!-- govuk_frontend_toolkit js -->
<script src="/public/javascripts/vendor/polyfills/bind.js"></script>
<script src="/public/javascripts/govuk/selection-buttons.js"></script>
<script src="/public/javascripts/govuk/shim-links-with-button-role.js"></script>
<script src="/public/javascripts/govuk/show-hide-content.js"></script>

<!-- govuk_elements js -->
<script src="/public/javascripts/govuk/details.polyfill.js"></script>
<script src="/public/javascripts/stackable.min.js"></script>
<script src="/public/javascripts/application.js"></script>


<script src="/public/javascripts/aml.js"></script>
<script src="/public/javascripts/tinysort.min.js"></script>


<script type="text/javascript"
  src=
"http://maps.googleapis.com/maps/api/js?key=AIzaSyB1tbIAqN0XqcgTR1-          FxYoVTVq6Is6lD98&sensor=false">
</script>
<script>
$(document).ready(function () {
    
    // get variables
    var i = 0;
    var className = $("#content").attr('class'); 


    //get url variables    
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return (false);
    } 
    var newLevyAccount = getQueryVariable("newLevyAccount");

     // get local storage variables
     var sessionState = JSON.parse(localStorage.getItem("sessionState"));

    switch(className){
        case 'search-select':
            searchSelect();
            break;
        case 'provider-detail-multiple':
            providerDetailMultiple();
            break;
        case 'provider-start':
            providerStart();
            break;
        case 'provider-results':
            providerResults();
            break;
        default: break;
    };
    
    
    function providerResults() {
        
        
        var resultSet = localStorage.getItem("resultSet");
        
            if ( resultSet == "0") {
                console.log("all levy providers")
                var nationalCount = $(".national").len;
            } else if ( resultSet == "1") {
                console.log("all non levy providers")
            } else if ( resultSet == "2") {
                console.log("levy paying with a provider name")
            } else if ( resultSet == "3") {
                console.log("levy payyign with location ")
            } else if (resultSet == "4") {
                console.log ("levy with name and location")
            } else if (resultSet == "5") {
                console.log("non levy with name")
            } else if (resultSet == "6") {
                console.log("non levy with location");
            } else if (resultSet == "7") {
                console.log("non levy with name and location");
            } else {
                console.log("please choose if you pay the levy");
            }
        
        // hide national    
        $("article.national").hide();
        $("article.national").show();
        
        //alert(nationalCount);
        
    }
    
    
    //alpha sort
            tinysort('#provider-results>article',{selector:'h2'});
    // distance sort
            tinysort('#provider-results>article',{selector:'article',data:'distance'});
    // national filter
            //$("article").attr("data-national").hide();

    
    function providerStart() {
        $(".button").click(function(e){
            e.preventDefault();
            var name = $("#name").val(); 
            console.log(name);
            var location = $("#location").val();
            console.log(location);
            var levy = $('input[name=levy-group]:checked').val();
            console.log(levy);
            
            if ( levy == "1" && name == ""  && location == "") {
                console.log("all levy providers")
               localStorage.setItem("resultSet","0");                
                window.location.href = "/sprint/{{sprint}}/provider/results";
            } else if ( levy == "2" && name == "" && location == "") {
               localStorage.setItem("resultSet","1");
                console.log("all non levy providers")
                window.location.href = "/sprint/{{sprint}}/provider/results";
            } else if ( levy == "1" && name != "" && location == "") {
               localStorage.setItem("resultSet","2");
                console.log("levy paying with a provider name")
                window.location.href = "/sprint/{{sprint}}/provider/results";
            } else if ( levy =="1"  && name == ""  && location != "") {
               localStorage.setItem("resultSet","3");
                console.log("levy payyign with location ")
                window.location.href = "/sprint/{{sprint}}/provider/results";
            } else if (levy == "1" && name != "" && location != "") {
               localStorage.setItem("resultSet","4");
                console.log ("levy with name and location")
                window.location.href = "/sprint/{{sprint}}/provider/results";
            } else if (levy ="2" && name != "" && location == "") {
               localStorage.setItem("resultSet","5");
                console.log("non levy with name")
                window.location.href = "/sprint/{{sprint}}/provider/results";
            } else if (levy == "2" && name == "" && location != "") {
               localStorage.setItem("resultSet","6");
                console.log("non levy with location");
                window.location.href = "/sprint/{{sprint}}/provider/results";
            } else if (levy == "2" && name != "" && location != "") {
               localStorage.setItem("resultSet","7");
                console.log("non levy with name and location");
                window.location.href = "/sprint/{{sprint}}/provider/results";
            } else if (levy == "") {
               localStorage.setItem("resultSet","8");
                console.log("please choose if you pay the levy");
            } else {
               localStorage.setItem("resultSet","9");
                console.log("please choose if you pay the levy");
            }
        })
    }

    
    
    
     
    function searchSelect() {
        $(".button").click(function(e){
            e.preventDefault();
            var state = $('input[name=radio-group]:checked').val();
            if ( state == "1" ) {
                //window.location.href = "/sprint/{{sprint}}/course/index";
                window.location.href = "https://findapprenticeshiptraining.sfa.bis.gov.uk/Apprenticeship/Search";
            } else if ( state == "2" ) {
                window.location.href = "/sprint/{{sprint}}/provider/index";
            } else {
                window.location.href ="/sprint/{{sprint}}/assesor/index";
            }
        })
    }
    
    function providerDetailMultiple() {
        
        $("#map-tab").hide();
        $(".course-index > a.map").click(function(e){
            e.preventDefault();
            $("#alpha-tab").hide();
            $("#map-tab").show();
            $(".course-index .alphabetic").removeClass("active");
            initGoogleMap();
        });
    }
    

    
    var locations = [
  ["Basildon",     51.576084, 0.488736],
  ["Brentwood",    51.620475,  0.307175],
  ["Chelmsford", 51.735587, 0.468550],
  ["Harlow", 51.767787, 0.087806]
];

function initGoogleMap(){

  var infowindow = new google.maps.InfoWindow(); /* SINGLE */
  var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 9,
      center: new google.maps.LatLng(51.620475,  0.307175)
  });
  
  function placeMarker( loc ) {
    var latLng = new google.maps.LatLng( loc[1], loc[2]);
    var marker = new google.maps.Marker({
      position : latLng,
      map      : map
    });
    google.maps.event.addListener(marker, 'click', function(){
        infowindow.close(); // Close previously opened infowindow
        infowindow.setContent( "<div id='infowindow'>"+ loc[0] +"</div>");
        infowindow.open(map, marker);
    });
  }
  
  // ITERATE ALL LOCATIONS
  // Don't create functions inside for loops
  // therefore refer to a previously created function
  // and pass your iterating location as argument value:
  for(var i=0; i<locations.length; i++) {
    placeMarker( locations[i] );
  } 
  
}
    
});

</script>

